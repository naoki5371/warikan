<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>äº¤é€šè²»å‰²ã‚Šå‹˜ã‚¢ãƒ—ãƒªï¼ˆæ±ç”¨ç‰ˆï¼‰</title>
  <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ç”¨è¨­å®š (å¿…è¦ã«å¿œã˜ã¦ icon.png ã‚’åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¦ãã ã•ã„) -->
  <link rel="apple-touch-icon" href="icon.png">

  <!-- PDFç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --bg: #f0f4f8;
      --card: #ffffff;
      --primary: #4a90e2;
      --primary-hover: #357abd;
      --text: #333;
      --accent-light: #e6f0fa;
      --border: #ddd;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      padding: 16px;
      background: var(--bg);
      margin: 0;
      color: var(--text);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    h1 { 
      font-size: 22px; 
      margin-bottom: 16px; 
      color: #2c3e50; 
      text-align: center;
    }

    .card {
      background: var(--card);
      padding: 20px;
      margin-bottom: 16px;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }

    h3 {
      margin-top: 0;
      border-bottom: 2px solid var(--accent-light);
      padding-bottom: 8px;
      color: var(--primary);
    }

    label {
      font-weight: 700;
      display: block;
      margin-top: 14px;
      font-size: 14px;
      color: #555;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    select {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 16px;
      background: #fafafa;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      background: #fff;
    }

    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      background: var(--primary);
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 12px;
      box-shadow: 0 4px 6px rgba(74, 144, 226, 0.2);
      transition: all 0.2s ease;
    }

    button:hover { 
      background: var(--primary-hover); 
      transform: translateY(-1px);
    }

    button.secondary {
      background: #fff;
      color: var(--primary);
      border: 2px solid var(--primary);
      box-shadow: none;
    }
    
    button.secondary:hover {
      background: var(--accent-light);
    }

    .checkbox-area { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 10px; 
      margin-top: 8px; 
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #eee;
      font-weight: normal;
      margin-top: 0;
      cursor: pointer;
    }
    
    .checkbox-label input {
      margin-right: 8px;
      transform: scale(1.2);
    }

    .result {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      border: 1px solid #eee;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .result-header {
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 10px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }

    .calc-steps {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 13px;
      color: #666;
      line-height: 1.6;
      border-left: 4px solid #ccc;
    }

    @media (max-width: 400px) {
      .checkbox-area { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <div class="card">
    <h1>ğŸš™ äº¤é€šè²»å‰²ã‚Šå‹˜ã‚¢ãƒ—ãƒª</h1>

    <label>å¤§ä¼šãƒ»ã‚¤ãƒ™ãƒ³ãƒˆå</label>
    <input type="text" id="eventName" placeholder="ä¾‹ï¼šã€‡ã€‡å¤§ä¼šã€åˆå®¿ãªã©" />

    <label>æ—¥ä»˜</label>
    <input type="date" id="eventDate" />
  </div>

  <div class="card" id="car-1">
    <h3>è¨ˆç®—ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h3>

    <label>é‹è»¢æ‰‹ï¼ˆã‚¬ã‚½ãƒªãƒ³ä»£ã‚’å—ã‘å–ã‚‹äººï¼‰</label>
    <select id="driver-1">
      <option value="å®¶æ—A">å®¶æ— A</option>
      <option value="å®¶æ—B">å®¶æ— B</option>
      <option value="å®¶æ—C">å®¶æ— C</option>
      <option value="å®¶æ—D">å®¶æ— D</option>
      <option value="å®¶æ—E">å®¶æ— E</option>
    </select>

    <label>ä¹—è»Šã—ãŸå®¶æ—ï¼ˆå‰²ã‚Šå‹˜ã™ã‚‹äººã‚’é¸æŠï¼‰</label>
    <div id="families-1" class="checkbox-area">
      <label class="checkbox-label"><input type="checkbox" value="å®¶æ—A"> å®¶æ— A</label>
      <label class="checkbox-label"><input type="checkbox" value="å®¶æ—B"> å®¶æ— B</label>
      <label class="checkbox-label"><input type="checkbox" value="å®¶æ—C"> å®¶æ— C</label>
      <label class="checkbox-label"><input type="checkbox" value="å®¶æ—D"> å®¶æ— D</label>
      <label class="checkbox-label"><input type="checkbox" value="å®¶æ—E"> å®¶æ— E</label>
    </div>

    <label>èµ°è¡Œè·é›¢ (å¾€å¾©)</label>
    <div style="position:relative;">
      <input type="number" id="distance-1" placeholder="0" inputmode="decimal" />
      <span style="position:absolute; right:12px; top:12px; color:#aaa;">km</span>
    </div>

    <label>ç‡ƒè²» (ãƒªãƒƒã‚¿ãƒ¼ã‚ãŸã‚Š)</label>
    <div style="position:relative;">
      <input type="number" id="fuel-1" placeholder="ä¾‹: 10" inputmode="decimal" />
      <span style="position:absolute; right:12px; top:12px; color:#aaa;">km/L</span>
    </div>

    <label>ã‚¬ã‚½ãƒªãƒ³å˜ä¾¡</label>
    <div style="position:relative;">
      <input type="number" id="price-1" placeholder="ä¾‹: 170" inputmode="numeric" />
      <span style="position:absolute; right:12px; top:12px; color:#aaa;">å††/L</span>
    </div>

    <label>é«˜é€Ÿæ–™é‡‘ (å¾€å¾©)</label>
    <div style="position:relative;">
      <input type="number" id="highway-1" placeholder="0" inputmode="numeric" />
      <span style="position:absolute; right:12px; top:12px; color:#aaa;">å††</span>
    </div>

    <label>é§è»Šå ´ä»£</label>
    <div style="position:relative;">
      <input type="number" id="parking-1" placeholder="0" inputmode="numeric" />
      <span style="position:absolute; right:12px; top:12px; color:#aaa;">å††</span>
    </div>
  </div>

  <button onclick="calculate()">è¨ˆç®—ã‚’å®Ÿè¡Œ</button>
  <button class="secondary" onclick="savePdf()">ğŸ–¨ çµæœã‚’PDFã§ä¿å­˜</button>

  <div id="pdf-area" style="padding: 10px;">
    <div id="pdf-header" style="text-align:center; font-size:16px; font-weight:bold; margin: 20px 0; color:#333; display:none;"></div>
    <div id="results"></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    document.getElementById('eventDate').value = `${yyyy}-${mm}-${dd}`;
});

function getCheckedFamilies(id) {
  return [...document.querySelectorAll(`#${id} input[type=checkbox]`)]
    .filter(b => b.checked)
    .map(b => b.value);
}

function calculate() {
  const resultsDiv = document.getElementById('results');
  const pdfHeader = document.getElementById('pdf-header');
  resultsDiv.innerHTML = '';
  
  const eventName = document.getElementById('eventName').value || 'åç§°æœªè¨­å®š';
  const eventDate = document.getElementById('eventDate').value;
  
  const driver = document.getElementById('driver-1').value;
  const families = getCheckedFamilies('families-1');

  const distance = Number(document.getElementById('distance-1').value);
  const fuel = Number(document.getElementById('fuel-1').value);
  const price = Number(document.getElementById('price-1').value);
  const highway = Number(document.getElementById('highway-1').value);
  const parking = Number(document.getElementById('parking-1').value);

  if (families.length === 0) {
    alert("å‰²ã‚Šå‹˜ã™ã‚‹å®¶æ—ï¼ˆãƒ¡ãƒ³ãƒãƒ¼ï¼‰ã‚’å°‘ãªãã¨ã‚‚1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚");
    return;
  }
  if (!fuel || fuel <= 0) {
    alert("ç‡ƒè²»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ä»¥å¤–ï¼‰ã€‚");
    return;
  }
  if (!distance && distance !== 0) {
     alert("èµ°è¡Œè·é›¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
     return;
  }

  const gasCost = (distance / fuel) * price;
  const totalCost = gasCost + highway + parking;
  const perFamilyCost = totalCost / families.length;

  pdfHeader.style.display = 'block';
  pdfHeader.innerHTML = `${eventDate}ã€€${eventName}<br><span style="font-size:14px; font-weight:normal;">äº¤é€šè²»ç²¾ç®—æ›¸</span>`;

  const box = document.createElement('div');
  box.className = 'result';

  box.innerHTML = `
    <div class="result-header">ç²¾ç®—çµæœ</div>
    <div style="font-size:15px; margin-bottom:8px;">
      <strong>æ”¯æ‰•å…ˆï¼ˆé‹è»¢æ‰‹ï¼‰ï¼š</strong> ${driver}
    </div>
    <div style="font-size:18px; color:#e74c3c; font-weight:bold; margin: 10px 0;">
      1å®¶æ—ã‚ãŸã‚Šï¼š${Math.ceil(perFamilyCost).toLocaleString()} å††
      <span style="font-size:12px; color:#666; font-weight:normal;">(ç«¯æ•°åˆ‡ã‚Šä¸Šã’)</span>
    </div>
    <div style="margin-bottom:10px; font-size:14px;">
      <strong>åˆè¨ˆç«‹æ›¿é¡ï¼š</strong> ${Math.floor(totalCost).toLocaleString()} å††
    </div>
    <div style="font-size:14px; margin-bottom:10px;">
       <strong>å¯¾è±¡ï¼š</strong> ${families.join('ã€')} (${families.length}å®¶æ—)
    </div>

    <div class="calc-steps">
      <strong>ğŸ“ è¨ˆç®—ã®è©³ç´°ï¼š</strong><br>
      <div style="margin-top:4px;">
      â‘  ã‚¬ã‚½ãƒªãƒ³ä»£<br>
      ã€€ (${distance} km Ã· ${fuel} km/L) Ã— ${price} å††/L = <strong>${Math.round(gasCost).toLocaleString()} å††</strong>
      </div>
      <div style="margin-top:8px;">
      â‘¡ åˆè¨ˆç«‹æ›¿é¡<br>
      ã€€ ã‚¬ã‚½ãƒªãƒ³ä»£ ${Math.round(gasCost).toLocaleString()} + é«˜é€Ÿ ${highway.toLocaleString()} + é§è»Š ${parking.toLocaleString()} = <strong>${Math.round(totalCost).toLocaleString()} å††</strong>
      </div>
      <div style="margin-top:8px;">
      â‘¢ 1å®¶æ—ã‚ãŸã‚Šã®è² æ‹…é¡<br>
      ã€€ ${Math.round(totalCost).toLocaleString()} å†† Ã· ${families.length} å®¶æ— = <strong>${Math.ceil(perFamilyCost).toLocaleString()} å††</strong>
      </div>
    </div>`;

  resultsDiv.appendChild(box);
  box.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function savePdf() {
  const resultsDiv = document.getElementById('results');
  if (!resultsDiv.hasChildNodes()) {
    alert("å…ˆã«ã€Œè¨ˆç®—ã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  const eventName = document.getElementById('eventName').value || 'ç²¾ç®—æ›¸';
  const eventDate = document.getElementById('eventDate').value || 'æ—¥ä»˜æœªè¨­å®š';
  const fileName = `äº¤é€šè²»ç²¾ç®—_${eventDate}_${eventName}.pdf`;

  const element = document.getElementById('pdf-area');

  const opt = {
    margin: 10,
    filename: fileName,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  const btn = event.target;
  const originalText = btn.innerText;
  btn.innerText = "ç”Ÿæˆä¸­...";
  
  html2pdf().set(opt).from(element).save().then(() => {
      btn.innerText = originalText;
  });
}
</script>

</body>
</html>